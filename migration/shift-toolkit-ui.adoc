---
sidebar: sidebar 
permalink: migration/shift-toolkit-ui.html 
keywords: netapp, vmware, esxi, vm, migration, openshift, virtualization, hyper-v, proxmox 
summary:  
---
= Configurer le kit d'outils NetApp Shift
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Configurer Shift Toolkit pour automatiser la migration ou la conversion des machines virtuelles) Ce processus comprend l'ajout de sites source et de destination, la configuration du stockage, le regroupement des machines virtuelles dans des groupes de ressources, la création de plans de migration et la planification des migrations.



== Boîte à outils Run Shift

* Utilisez le navigateur pour accéder à l'interface utilisateur de Shift Toolkit en saisissant le `http://<IP address specified during installation>:3001`
+
Remarque : Pour une expérience optimale, utilisez Google Chrome ou Internet Explorer.

* Accédez à l'interface utilisateur en utilisant les identifiants par défaut suivants : Nom d'utilisateur : admin Mot de passe : admin
+
image::shift-toolkit-050.png[Diagramme de l'écran de connexion de NetApp Shift Toolkit]

+
Remarque : Les administrateurs sont tenus de modifier leurs identifiants lors de la première connexion.

+
Remarque : après la modification obligatoire du mot de passe, les identifiants d’administrateur peuvent également être modifiés à l’aide de l’option « Modifier le mot de passe » après s’être connecté à l’interface graphique.

+
image::shift-toolkit-051.png[Diagramme de l'écran de changement de mot de passe de NetApp Shift Toolkit]

+
Une fois terminé, acceptez le CLUF en cliquant sur « Accepter et continuer ».

+
image::shift-toolkit-052.png[Capture d'écran du contrat de licence utilisateur final (CLUF) de NetApp]





== Configuration de Shift Toolkit

Une fois que le stockage et la connectivité aux hyperviseurs source et de destination ont été correctement configurés, commencez à configurer le kit d'outils Shift pour automatiser la migration ou la conversion des machines virtuelles au format approprié, en tirant parti de la fonctionnalité FlexClone .



=== Ajouter des sites

La première étape consiste à découvrir et à ajouter les détails de l'hyperviseur source puis cible (à la fois les hyperviseurs et le stockage) à la boîte à outils Shift.  Ouvrez Shift Toolkit dans un navigateur compatible, utilisez le nom d'utilisateur et le mot de passe par défaut, puis cliquez sur « Ajouter des sites ».

image::shift-toolkit-053.png[Boîte de dialogue Ajouter des sites de Shift Toolkit]

Remarque : Il est également possible d’ajouter des sites via l’option Découvrir.

Ajoutez les plateformes suivantes :



==== Source

* Détails du site source
+
** Nom du site - Donnez un nom au site
** Hyperviseur – Sélectionnez VMware ou Hyper-V comme source
** Emplacement du site – Sélectionnez l’option par défaut
** Connecteur – Sélectionnez la sélection par défaut




Une fois rempli, cliquez sur Continuer.

image::shift-toolkit-054.png[Boîte de dialogue « Ajouter un nouveau site » de Shift Toolkit]

* Si vous sélectionnez VMware, saisissez les détails du vCenter source.
+
** Point de terminaison - Saisissez l'adresse IP ou le nom de domaine complet du serveur vCenter
** Nom d'utilisateur - nom d'utilisateur pour accéder au vCenter (au format UPN : nom d'utilisateur@domaine.com)
** Mot de passe vCenter – Mot de passe pour accéder à vCenter afin d’effectuer l’inventaire des ressources.
** Empreinte numérique SSL vCenter (facultatif)


* Si l'option sélectionnée est Hyper-V, saisissez les détails de la source Hyper-V.
+
** Point de terminaison - Saisissez l'adresse IP ou le nom de domaine complet (FQDN) des hôtes autonomes ou du point de terminaison du cluster de basculement.
** Nom d'utilisateur Hyper-V - nom d'utilisateur permettant d'accéder à Hyper-V (au format de connexion de niveau inférieur (domaine\nom d'utilisateur) ou UPN)
** Mot de passe Hyper-V – Mot de passe permettant d'accéder à Hyper-V pour effectuer l'inventaire des ressources.
+
 Select “Accept Self signed certificate” and click Continue.


* Informations d'identification du système de stockage ONTAP


image::shift-toolkit-055.png[Boîte de dialogue « Ajouter un nouveau site » de Shift Toolkit]

Une fois ajouté, Shift Toolkit effectuera une découverte automatique et affichera les machines virtuelles ainsi que les informations de métadonnées pertinentes. L'outil Shift détectera automatiquement les réseaux et les VLAN utilisés par les machines virtuelles et les renseignera.

Remarque : Si des modifications sont apportées au site source, assurez-vous d'exécuter la recherche pour récupérer les informations les plus récentes.  Pour cela, il suffit de cliquer sur les trois points en regard du nom du site, puis de cliquer sur « Découvrir le site ».

Remarque : L'inventaire des machines virtuelles est automatiquement actualisé toutes les 24 heures.

image::shift-toolkit-056.png[Boîte de dialogue Ajouter un nouveau site de Shift Toolkit pour découvrir un site]

Pour consulter les données de découverte d'un hyperviseur source spécifique, accédez au tableau de bord et cliquez sur « Afficher la liste des machines virtuelles » en regard du nom du site approprié. La page affichera l’inventaire de la VM ainsi que les attributs de la VM.

image::shift-toolkit-057.png[Sites découverts dans la boîte à outils Shift]

L’étape suivante consiste à ajouter l’hyperviseur de destination. Pour ajouter un site, cliquez sur « Ajouter un nouveau site » et sélectionnez « Destination ».



==== Destination

image::shift-toolkit-058.png[Boîte de dialogue Ajouter un site de Shift Toolkit pour la destination]

* Détails du site de destination
+
** Nom du site - Donnez un nom au site
** Hyperviseur – Choisissez la plateforme cible appropriée parmi les options suivantes :
+
*** VMware
*** Hyper-V
*** OpenShift
*** OLVM
*** KVM (conversion uniquement)


** Emplacement du site – Sélectionnez l’option par défaut
** Connecteur – Sélectionnez la sélection par défaut




Une fois rempli, cliquez sur Continuer.

image::shift-toolkit-059.png[Boîte de dialogue Ajouter un site de Shift Toolkit pour les détails de la destination]

En fonction de la sélection de l'hyperviseur, remplissez les détails nécessaires.

* Détails de l'hyperviseur de destination
+
** Adresse IP ou nom de domaine complet (FQDN) du point de terminaison du gestionnaire d'hyperviseur respectif
** Nom d'utilisateur – nom d'utilisateur permettant l'accès (au format UPN : nom_utilisateur@domaine.com ou domaine\administrateur) Mot de passe – Mot de passe permettant l'accès pour effectuer l'inventaire des ressources.




Sélectionnez « Accepter le certificat auto-signé ».

* Une fois terminé, cliquez sur « Créer un site ».


Remarque : Le système de stockage source et le système de stockage de destination doivent être identiques, car la conversion du format de disque s'effectue au niveau du volume et au sein du même volume.

image::shift-toolkit-060.png[Boîte de dialogue Ajouter un site de Shift Toolkit pour les détails de la destination]

L’étape suivante consiste à regrouper les machines virtuelles requises dans leurs groupes de migration en tant que groupes de ressources.



=== Groupements de ressources

Une fois les plateformes ajoutées, regroupez les machines virtuelles que vous souhaitez migrer ou convertir en groupes de ressources.  Les groupes de ressources de la boîte à outils Shift vous permettent de regrouper un ensemble de machines virtuelles dépendantes en groupes logiques contenant leurs ordres de démarrage et leurs délais de démarrage.

Remarque : assurez-vous que les Qtrees sont provisionnés (comme indiqué dans la section des prérequis) avant de créer les groupes de ressources.

Pour commencer à créer des groupes de ressources, cliquez sur l'élément de menu « Créer un nouveau groupe de ressources ».

. Accédez aux groupes de ressources, puis cliquez sur « Créer un nouveau groupe de ressources ».
+
image::shift-toolkit-061.png[Boîte de dialogue de l'interface utilisateur Créer un nouveau groupe de ressources]

. Dans le groupe de ressources « Nouveau », sélectionnez le site source dans la liste déroulante et cliquez sur « Créer ».
. Fournissez les détails du groupe de ressources et sélectionnez le flux de travail.  Le flux de travail propose deux options
+
.. Migration basée sur le clonage : effectue la migration de bout en bout de la machine virtuelle de l'hyperviseur source vers l'hyperviseur de destination.
.. Conversion basée sur le clonage – Effectue la conversion du format de disque vers le type d’hyperviseur sélectionné.
+
image::shift-toolkit-062.png[Boîte de dialogue de l'interface utilisateur Créer un nouveau groupe de ressources]



. Cliquez sur « Continuer »
. Sélectionnez les machines virtuelles appropriées à l’aide de l’option de recherche. L'option de filtre par défaut est « Datastore ».
+
Remarque : Déplacez les machines virtuelles à convertir ou à migrer vers un datastore désigné sur une SVM ONTAP nouvellement créée avant la conversion. Cela permet d'isoler le magasin de données NFS de production et le magasin de données désigné peut être utilisé pour la préparation des machines virtuelles.

+
Remarque : Dans un environnement OpenShift, les VMDK doivent être déplacés vers leurs volumes correspondants afin de reproduire la structure PVC (Persistent Volume Claim) à l’aide du pilote de stockage ONTAP NAS.  Dans les prochaines versions, des améliorations supplémentaires seront intégrées pour tirer parti du pilote économique ONTAP NAS.

+
image::shift-toolkit-063.png[Boîte de dialogue de l'interface utilisateur Créer un nouveau groupe de ressources]

+
Remarque : Dans ce contexte, la liste déroulante des banques de données n'affichera que les banques de données NFSv3. Les banques de données NFSv4 ne seront pas affichées.

+
image::shift-toolkit-064.png[Boîte de dialogue de l'interface utilisateur Créer un nouveau groupe de ressources]

. Mettez à jour les détails de la migration en sélectionnant « Site de destination », « Entrée Hyperviseur de destination » et « Mappage Datastore vers Qtree ou classe de stockage ».
+
image::shift-toolkit-065.png[Boîte de dialogue de l'interface utilisateur Créer un nouveau groupe de ressources]

+
Remarque : lors de la conversion des machines virtuelles, assurez-vous que le chemin de destination (où sont stockées les machines virtuelles converties) est défini sur un qtree.  Définissez le chemin de destination vers l'arbre qtree approprié.

+
Remarque : Plusieurs qtrees peuvent être créés et utilisés pour stocker les disques de VM convertis.

+
Remarque : Les machines virtuelles peuvent s’exécuter sur des datastores étendus, et Shit toolkit les détectera automatiquement ; toutefois, un qtree doit être mappé pour chaque volume.

+
Possibilité de migrer des machines virtuelles avec des VMDK étendus sur plusieurs volumes. L'interface utilisateur de l'outil Shift sélectionne automatiquement tous les volumes étendus qui font partie d'une ou plusieurs machines virtuelles sélectionnées pour ce groupe de ressources spécifique.  Cette page listera tous les volumes présents sur le RG où nous effectuons le mappage datastore – qtree.

+
image::shift-toolkit-066.png[Boîte de dialogue de l'interface utilisateur Créer un nouveau groupe de ressources]

. Sélectionnez l'ordre de démarrage et le délai de démarrage (en secondes) pour toutes les machines virtuelles sélectionnées. Définissez l’ordre de mise sous tension en sélectionnant chaque machine virtuelle et en définissant sa priorité. 3 est la valeur par défaut pour toutes les machines virtuelles. Les options sont les suivantes : 1 – La première machine virtuelle à démarrer ; 3 – Par défaut ; 5 – La dernière machine virtuelle à démarrer.
+
image::shift-toolkit-067.png[Boîte de dialogue de l'interface utilisateur Créer un nouveau groupe de ressources]

. Cliquez sur « Créer un groupe de ressources ».
+
image::shift-toolkit-068.png[Boîte de dialogue de l'interface utilisateur Créer un nouveau groupe de ressources]

+
Remarque : Si vous devez modifier le groupe de ressources pour ajouter ou supprimer des machines virtuelles, utilisez cette option en regard du nom du groupe de ressources et sélectionnez « Modifier le groupe de ressources ».





=== Plans

Pour migrer ou convertir des machines virtuelles, un plan est nécessaire. Sélectionnez les plates-formes d'hyperviseur source et de destination dans la liste déroulante et choisissez les groupes de ressources à inclure dans ce plan, ainsi que le regroupement de la manière dont les applications doivent être mises sous tension (c'est-à-dire les contrôleurs de domaine, puis le niveau 1, puis le niveau 2, etc.). On les appelle souvent aussi plans de migration. Pour définir le plan, accédez à l'onglet « Plans » et cliquez sur « Créer un nouveau plan ».

Pour commencer à créer un plan, cliquez sur « Créer un nouveau plan ».

. Accédez à Plans, cliquez sur « Créer un nouveau plan ».
+
image::shift-toolkit-069.png[Dialogue de l'interface utilisateur d'Access Blueprints]

. Dans la section « Nouveau plan », indiquez un nom pour le plan et ajoutez les mappages d'hôtes nécessaires en sélectionnant Site source > vCenter associé, Site de destination et hyperviseur associé.
. Une fois les mappages effectués, sélectionnez le cluster et le mappage de l'hôte. Dans l'exemple ci-dessous, Hyper-V est présenté comme la cible.  L'option d'hyperviseur affichée variera en fonction du site source sélectionné.
+
image::shift-toolkit-070.png[Boîte de dialogue de l'interface utilisateur Créer de nouveaux plans]

. Sélectionnez « Détails du groupe de ressources » et cliquez sur « Continuer ».
+
image::shift-toolkit-071.png[Boîte de dialogue de l'interface utilisateur Créer de nouveaux plans]

. Définir l’ordre d’exécution pour le groupe de ressources.  Cette option permet de sélectionner la séquence d'opérations lorsque plusieurs groupes de ressources existent.
. Après avoir effectué les étapes précédentes, sélectionnez « Cartographie réseau » et attribuez-la à la carte réseau appropriée.  Assurez-vous que les commutateurs virtuels, les profils réseau ou les opérateurs sont déjà configurés sur l'hyperviseur cible.
+
image::shift-toolkit-072.png[Boîte de dialogue de l'interface utilisateur Créer de nouveaux plans]

+
Remarque : pour les tests de migration, l’option « Ne pas configurer le réseau » est sélectionnée par défaut et Shift Toolkit n’effectue pas d’attribution d’adresse IP.  Une fois le disque converti et la machine virtuelle achetée côté hyperviseur respectif, assignez manuellement les commutateurs réseau de type bulle pour éviter tout conflit avec le réseau de production.

+
image::shift-toolkit-073.png[Boîte de dialogue de l'interface utilisateur Créer de nouveaux plans]

. En fonction de la sélection des machines virtuelles, les mappages de stockage seront automatiquement sélectionnés.
+
Remarque : assurez-vous que le qtree est provisionné au préalable et que les autorisations nécessaires sont attribuées afin que la machine virtuelle puisse être créée et mise sous tension.  Remarque : Dans le cas d’OpenShift, les PVC sont créés à l’aide de Trident CSI et il n’est pas nécessaire de pré-créer des qtrees.

. Sous les détails de la machine virtuelle, indiquez le compte de service et les informations d’identification utilisateur valides pour chaque type de système d’exploitation.  Ceci est utilisé pour se connecter à la machine virtuelle afin de créer et d'exécuter certains scripts nécessaires à la suppression des outils VMware et à la sauvegarde des détails de configuration IP.
+
.. Pour les systèmes d'exploitation Windows, il est recommandé d'utiliser un utilisateur disposant de privilèges d'administrateur local. Les informations d'identification de domaine peuvent également être utilisées, mais assurez-vous qu'un profil utilisateur existe sur la machine virtuelle avant la conversion ; sinon, les informations d'identification de domaine ne fonctionneront pas car le système recherchera une authentification de domaine alors qu'aucun réseau n'est connecté.
.. Dans le cas des machines virtuelles invitées basées sur une distribution Linux, fournissez un utilisateur qui peut exécuter des commandes sudo sans mot de passe, ce qui signifie que l'utilisateur doit faire partie de la liste sudoers ou être ajouté comme nouveau fichier de configuration au dossier /etc/sudoers.d/.
+
image::shift-toolkit-074.png[Boîte de dialogue de l'interface utilisateur Créer de nouveaux plans]

+
Dans sa dernière version, Shift Toolkit a introduit une plus grande flexibilité dans la préparation des machines virtuelles.  Par défaut, l'outil automatise la préparation des machines virtuelles en déployant des scripts spécifiques au système d'exploitation pour : * Supprimer VMware Tools * Sauvegarder les paramètres IP en vue de leur réattribution selon le modèle sélectionné

+
+ Grâce à cette nouvelle amélioration, les utilisateurs peuvent désormais remplacer les tâches prepareVM par défaut, ce qui leur permet d'exécuter des scripts personnalisés pour la préparation manuelle des machines virtuelles, y compris l'attribution d'adresses IP.  Cela permet un meilleur contrôle des environnements présentant des exigences de configuration ou de conformité uniques.



. Encore une fois, sous les détails de la VM, sélectionnez l’option de configuration IP appropriée. Par défaut, l'option « Ne pas configurer » est sélectionnée.
+
.. Pour migrer les machines virtuelles ayant les mêmes adresses IP que le système source, sélectionnez « Conserver l’adresse IP ».
.. Pour migrer les machines virtuelles utilisant des adresses IP statiques dans le système source et attribuer le DHCP aux machines virtuelles cibles, sélectionnez « DHCP ».
+
Assurez-vous que les exigences suivantes sont remplies pour que cette fonctionnalité fonctionne :

+
*** Assurez-vous que les machines virtuelles sont sous tension pendant la phase de préparation de la machine virtuelle et jusqu'à l'heure de migration planifiée.
*** Pour les machines virtuelles VMware, assurez-vous que VMware Tools est installé.
*** Si Hyper-V est utilisé comme hyperviseur source, assurez-vous que les services d'intégration sont activés et configurés.
*** Pour OLVM et OpenShift comme hyperviseur cible, assurez-vous de monter le fichier ISO virtIO sur les machines virtuelles Windows.
*** Assurez-vous que le script de préparation est exécuté sur la machine virtuelle source par un compte disposant de privilèges d'administrateur sous Windows et de privilèges sudo sans option de mot de passe sous Linux pour créer des tâches cron.




. L’étape suivante est la configuration de la machine virtuelle.
+
** Redimensionnez éventuellement les paramètres CPU/RAM des machines virtuelles, ce qui peut être très utile à des fins de redimensionnement.
** Remplacement de l'ordre de démarrage : modifiez également l'ordre de démarrage et le délai de démarrage (en secondes) pour toutes les machines virtuelles sélectionnées dans les groupes de ressources.  Il s'agit d'une option supplémentaire permettant de modifier l'ordre de démarrage si des modifications sont nécessaires par rapport à ce qui a été sélectionné lors de la sélection de l'ordre de démarrage du groupe de ressources.  Par défaut, l'ordre de démarrage sélectionné lors de la sélection du groupe de ressources est utilisé, mais toutes les modifications peuvent être effectuées à ce stade.
** Mise sous tension : décochez cette option si le flux de travail ne doit pas mettre sous tension la machine virtuelle.  L'option par défaut est ON, ce qui signifie que la machine virtuelle sera sous tension.
** Supprimer les outils VMware : Shift Toolkit supprime les outils VMware après la conversion. Cette option est sélectionnée par défaut. Cette option peut être désélectionnée si le plan consiste à exécuter les scripts personnalisés du client.
** Génération : Shift Toolkit utilise la règle empirique suivante et utilise par défaut la règle appropriée : Gen1 > BIOS et Gen2 > EFI.  Aucune sélection n'est possible pour cette option.
** Conserver l'adresse MAC : l'adresse MAC des machines virtuelles respectives peut être conservée pour surmonter les problèmes de licence pour les applications s'appuyant sur MAC.
** Remplacement du compte de service : cette option permet de spécifier un compte de service distinct si le compte global ne peut pas être utilisé.
+
image::shift-toolkit-075.png[Boîte de dialogue de l'interface utilisateur du groupe de ressources]



. Cliquez sur « Continuer ».
. À l’étape suivante, planifiez la migration en cochant la case pour définir la date et l’heure. Assurez-vous que toutes les machines virtuelles (VM) sont préparées et éteintes avant la date prévue. Une fois terminé, cliquez sur « Créer un plan ».
+
image::shift-toolkit-076.png[Boîte de dialogue de l'interface utilisateur du groupe de ressources]

+
Remarque : lors de la planification, choisissez une date qui est au moins 30 minutes avant l'heure actuelle de la machine virtuelle Shift. Cela permet de garantir que le flux de travail dispose de suffisamment de temps pour préparer les machines virtuelles au sein du groupe de ressources.

. Une fois le plan créé, une tâche prepareVM est lancée et exécute automatiquement des scripts sur les machines virtuelles sources pour les préparer à la migration.
+
image::shift-toolkit-077.png[Boîte de dialogue de l'interface utilisateur du groupe de ressources]

+
Ce travail exécute un script à l'aide de la méthode invoke-VMScript pour copier les scripts nécessaires à la suppression des outils VMware et à la sauvegarde des détails de configuration réseau, notamment l'adresse IP, les itinéraires et les informations DNS, qui seront utilisés pour conserver les mêmes paramètres sur la machine virtuelle cible.

+
.. Pour les systèmes d'exploitation Windows, l'emplacement par défaut où sont stockés les scripts de préparation est le dossier « C:\ NetApp».
+
image::shift-toolkit-078.png[Boîte de dialogue de l'interface utilisateur du groupe de ressources]

.. Pour les machines virtuelles basées sur Linux, l'emplacement par défaut où les scripts de préparation sont stockés est / NetApp et le répertoire /opt.
+
image::shift-toolkit-079.png[Boîte de dialogue de l'interface utilisateur du groupe de ressources]

+
Remarque : Pour une machine virtuelle Linux exécutant CentOS ou Red Hat, Shift Toolkit installe automatiquement les pilotes Hyper-V nécessaires. Ces pilotes doivent être présents dans la machine virtuelle source avant la conversion du disque pour garantir que la machine virtuelle puisse démarrer avec succès après la conversion.

+
Remarque : Pour plus d'informations, veuillez consulterlink:https://access.redhat.com/solutions/3465011["Système bloqué en dracut après la migration d'une VM RHEL vers hyper-v"] .

+
Une fois la tâche prepareVM terminée avec succès (comme indiqué dans la capture d'écran ci-dessous), les machines virtuelles sont prêtes pour la migration et l'état du plan sera mis à jour sur « Actif ».

+
image::shift-toolkit-080.png[Boîte de dialogue de l'interface utilisateur du groupe de ressources]

+
image::shift-toolkit-081.png[Boîte de dialogue de l'interface utilisateur du groupe de ressources]

+
La migration se produira désormais à l'heure définie ou peut être démarrée manuellement en cliquant sur l'option Migrer.




