---
sidebar: sidebar 
permalink: migration/shift-toolkit-migrate-hyperv2esxi.html 
keywords: netapp, vmware, esxi, vm, migration, virtualization, hyper-v, microsoft 
summary: 'Migrez les machines virtuelles de Microsoft Hyper-V vers VMware ESXi à l"aide de Shift Toolkit en configurant les sites source et de destination, en créant des groupes de ressources et des modèles, et en exécutant le flux de travail de migration.' 
---
= Migrez des machines virtuelles de Microsoft Hyper-V vers VMware ESXi à l'aide du kit d'outils Shift.
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Migrez les machines virtuelles de Microsoft Hyper-V vers VMware ESXi à l'aide de Shift Toolkit en configurant les sites source et de destination, en créant des groupes de ressources et des modèles, et en exécutant le flux de travail de migration.

Le Shift Toolkit permet la conversion directe de machines virtuelles entre hyperviseurs sans créer de copies de disque supplémentaires, offrant une migration sans copie avec un temps d'arrêt minimal pour les machines virtuelles Windows et Linux.



== Avant de commencer

Vérifiez que les conditions préalables suivantes sont remplies avant de commencer la migration.

.Exigences VMware
* Les hôtes vCenter et ESXi sont configurés
* Compte serveur vCenter (utilisateur RBAC) avec les privilèges minimaux requis
* Les hôtes vCenter et ESXi sont accessibles depuis Shift Toolkit et les entrées DNS sont à jour.
* Les groupes de ports distribués sont configurés avec les ID de VLAN appropriés (les groupes de ports standard ne sont pas pris en charge).
* Le partage NFS (pour stocker les machines virtuelles migrées) et le partage source (pour les machines virtuelles à migrer) résident sur le même volume.


.Exigences Hyper-V
* Les fichiers VM VHDx sont placés sur un partage SMB
+
** Si les machines virtuelles se trouvent sur un volume partagé de cluster (CSV), effectuez une migration à chaud vers un partage SMB.


* Les services d'intégration Hyper-V sont activés et fonctionnent sur les machines virtuelles invitées.
* Les machines virtuelles à migrer sont en état d'exécution en vue de leur préparation.
* Les machines virtuelles doivent être mises hors tension avant de déclencher la migration.


.Exigences relatives aux machines virtuelles invitées
* Pour les machines virtuelles Windows : utilisez les informations d’identification d’un administrateur local ou d’un domaine avec un profil utilisateur existant sur la machine virtuelle.
* Pour les machines virtuelles Linux : utilisez un utilisateur disposant des autorisations nécessaires pour exécuter des commandes sudo sans invite de mot de passe.
* Shift Toolkit utilise PowerShell Direct pour les machines virtuelles Windows et SSH pour les machines virtuelles Linux.




== Étape 1 : Ajouter le site source (Hyper-V)

Ajoutez l'environnement Hyper-V source à Shift Toolkit.

.Étapes
. Ouvrez Shift Toolkit dans un navigateur compatible et connectez-vous avec les identifiants par défaut.
. Accédez à *Découvrir > Ajouter des sites*.
+
.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-350.png[Menu Ajouter des sites]

====
. Cliquez sur *Ajouter un nouveau site* et sélectionnez *Source*.
. Saisissez les détails du site source :
+
** Nom du site : Veuillez indiquer un nom pour le site.
** Hyperviseur : sélectionnez Hyper-V
** *Emplacement du site* : Sélectionnez l’option par défaut
** *Connecteur* : Sélectionnez la sélection par défaut


. Cliquez sur *Continuer*.
+
.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-351.png[Détails du site source]

====
. Saisissez les détails Hyper-V :
+
** Gestionnaire de cluster Hyper-V autonome ou de basculement : adresse IP ou nom de domaine complet
** *Nom d'utilisateur* : Nom d'utilisateur au format UPN (nom_utilisateur@domaine.com ou domaine\administrateur)
** Mot de passe : Mot de passe permettant d’accéder à l’hôte Hyper-V ou à l’instance FCI


. Cliquez sur *Continuer*.
+
.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-352.png[Identifiants Hyper-V]

====
+

NOTE: L'interface FCI Hyper-V et la découverte d'hôte reposent sur la résolution DNS. Si la résolution échoue, mettez à jour le fichier host (C:\Windows\System32\drivers\etc\hosts) et réessayez l'opération de découverte.

. Saisissez les informations d'identification du système de stockage ONTAP .
+
.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-353.png[Informations d'identification ONTAP]

====
. Cliquez sur *Créer un site*.


.Résultat
L'outil Shift Toolkit effectue une découverte automatique et affiche les machines virtuelles avec des informations de métadonnées, notamment les réseaux, les commutateurs virtuels et les identifiants VLAN.

.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-354.png[Résultats de la découverte]

====

NOTE: L'inventaire des machines virtuelles s'actualise automatiquement toutes les 24 heures.  Pour actualiser manuellement après des modifications, cliquez sur les trois points situés à côté du nom du site et sélectionnez *Découvrir le site*.



== Étape 2 : Ajouter le site de destination (VMware ESXi)

Ajoutez l'environnement VMware de destination à Shift Toolkit.

.Étapes
. Cliquez sur *Ajouter un nouveau site* et sélectionnez *Destination*.
+
.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-357.png[Ajouter le site de destination]

====
. Saisissez les détails du site de destination :
+
** Nom du site : Veuillez indiquer un nom pour le site.
** Hyperviseur : sélectionnez VMware
** *Emplacement du site* : Sélectionnez l’option par défaut
** *Connecteur* : Sélectionnez la sélection par défaut


. Cliquez sur *Continuer*.
+
.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-358.png[Détails du site de destination]

====
. Saisissez les informations relatives à VMware vCenter :
+
** *Point de terminaison* : Adresse IP ou nom de domaine complet (FQDN) du serveur vCenter
** *Nom d'utilisateur* : Nom d'utilisateur au format UPN (nom_utilisateur@domaine.com)
** Mot de passe vCenter : Mot de passe permettant d’accéder à vCenter
** *Empreinte SSL vCenter* (facultatif)


. Sélectionnez *Accepter le certificat auto-signé* et cliquez sur *Continuer*.
+
.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-359.png[Informations d'identification vCenter]

====
. Cliquez sur *Créer un site*.
+
.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-360.png[confirmation de création du site]

====
+

NOTE: Le système de stockage source et le système de stockage de destination doivent être identiques, car la conversion du format de disque s'effectue au niveau du volume au sein du même volume.





== Étape 3 : Créer des groupes de ressources

Organisez les machines virtuelles en groupes de ressources afin de préserver l'ordre de démarrage et les configurations de délai de démarrage.

.Avant de commencer
Assurez-vous que les qtrees sont provisionnés conformément aux prérequis.

.Étapes
. Accédez à *Groupes de ressources* et cliquez sur *Créer un nouveau groupe de ressources*.
. Sélectionnez le site source dans la liste déroulante et cliquez sur *Créer*.
. Fournissez les détails du groupe de ressources et sélectionnez le flux de travail :
+
** Migration par clonage : effectue une migration de bout en bout de l’hyperviseur source vers l’hyperviseur de destination.
** *Conversion basée sur le clonage* : Convertit le format du disque vers le type d’hyperviseur sélectionné
+
.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-361.png[Flux de travail du groupe de ressources]

====


. Cliquez sur *Continuer*.
. Sélectionnez les machines virtuelles à l'aide de l'option de recherche (le filtre par défaut est « Datastore »).
+
.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-362.png[sélection de VM]

====
+

NOTE: Déplacez les machines virtuelles vers un partage SMB désigné sur une SVM ONTAP nouvellement créée avant la conversion afin d'isoler les partages de production de la zone de transit.  Le menu déroulant « Stockage de données » n'affiche que les partages SMB ; les fichiers CSV ne sont pas affichés.

+
.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-363.png[Sélection du magasin de données]

====
. Détails de la migration mis à jour :
+
** Sélectionnez *Site de destination*
** Sélectionnez *Entrée VMware de destination*
** Configurer le mappage du volume vers l'arbre qtree
+
.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-364.png[Détails de la migration]

====
+

NOTE: Définissez le chemin de destination vers l'arborescence qtree appropriée lors de la conversion de machines virtuelles d'Hyper-V vers ESXi.



. Configurer l'ordre de démarrage et le délai de démarrage pour toutes les machines virtuelles sélectionnées :
+
** *1* : Première machine virtuelle à s'allumer
** *3* : Par défaut
** *5* : Dernière machine virtuelle à s'allumer


. Cliquez sur *Créer un groupe de ressources*.
+
.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-365.png[configuration de l'ordre de démarrage]

====


.Résultat
Le groupe de ressources est créé et prêt pour la configuration du plan.



== Étape 4 : Créer un plan de migration

Élaborez un plan directeur définissant la stratégie de migration, incluant les correspondances de plateformes, la configuration réseau et les paramètres des machines virtuelles.

.Étapes
. Accédez à *Plans* et cliquez sur *Créer un nouveau plan*.
. Indiquez un nom pour le modèle et configurez les mappages d'hôtes :
+
** Sélectionnez *Site source* et l'hyperviseur Hyper-V associé
** Sélectionnez le *site de destination* et le vCenter associé.
** Configurer le mappage de l'hôte et du cluster
+
.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-366.png[Mappages d'hôtes Blueprint]

====


. Sélectionnez les détails du groupe de ressources et cliquez sur *Continuer*.
. Définissez l'ordre d'exécution des groupes de ressources s'il en existe plusieurs.
. Configurez le mappage réseau vers les groupes de ports appropriés.
+
.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-367.png[Cartographie du réseau]

====
+

NOTE: Sur VMware, seul le groupe de ports distribués est pris en charge.  Pour la migration de test, sélectionnez « Ne pas configurer le réseau » afin d'éviter les conflits avec le réseau de production ; attribuez manuellement les paramètres réseau après la conversion.

+
.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-368.png[options de configuration réseau]

====
. Vérifier les mappages de stockage (sélectionnés automatiquement en fonction de la sélection de la machine virtuelle).
+

NOTE: Assurez-vous que les qtrees sont provisionnés au préalable avec les autorisations nécessaires.

. Configurez la procédure de préparation de la machine virtuelle si nécessaire pour les scripts personnalisés ou la personnalisation de l'adresse IP.
+
.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-369.png[Priorité à la préparation]

====
. Dans les détails de la machine virtuelle, indiquez le compte de service et les informations d'identification pour chaque type de système d'exploitation :
+
** *Windows* : Identifiants d’administrateur local ou de domaine (vérifiez que le profil utilisateur existe sur la machine virtuelle)
** Linux : Utilisateur disposant des privilèges sudo sans invite de mot de passe
+
.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-370.png[identifiants du compte de service]

====


. Configurer les paramètres IP :
+
** *Ne pas configurer* : Option par défaut
** *Conserver l'adresse IP* : Conserver les mêmes adresses IP que celles du système source
** *DHCP* : Attribuer un serveur DHCP aux machines virtuelles cibles
+
Assurez-vous que les machines virtuelles sont allumées pendant la phase prepareVM et que les services d'intégration sont activés.



. Configurer les paramètres de la machine virtuelle :
+
** Redimensionner les paramètres du processeur/de la RAM (facultatif)
** Modifier l'ordre de démarrage et le délai de démarrage
** *Mise sous tension* : Sélectionnez cette option pour mettre les machines virtuelles sous tension après la migration (par défaut : activée).
** *Ajouter les outils VMware* : Installer les outils VMware après la conversion (par défaut : sélectionné)
** *Conserver l'adresse MAC* : Conservez les adresses MAC pour les exigences de licence.
** *Remplacement du compte de service* : Spécifiez un compte de service distinct si nécessaire
+
.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-371.png[Configuration VM]

====


. Cliquez sur *Continuer*.
. (Facultatif) Planifiez la migration en sélectionnant une date et une heure.
+
.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-372.png[calendrier de migration]

====
+

NOTE: Planifiez les migrations au moins 30 minutes à l'avance pour laisser le temps nécessaire à la préparation des machines virtuelles.

. Cliquez sur *Créer un plan*.


.Résultat
Le Shift Toolkit lance une tâche prepareVM qui exécute des scripts sur les machines virtuelles sources afin de les préparer à la migration.

.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-373.png[Tâche PrepareVM initiée]

====
Le processus de préparation :

* Pour les machines virtuelles Windows : stocke les scripts dans `C:\NetApp`
+
.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-374.png[Scripts de préparation Windows]

====
* Pour les machines virtuelles Linux : stocke les scripts dans `/NetApp` et `/opt`
+
.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-375.png[Scripts de préparation Linux]

====
+

NOTE: Pour les machines virtuelles CentOS ou Red Hat, Shift Toolkit installe automatiquement les pilotes nécessaires avant la conversion du disque afin de garantir un démarrage réussi après la conversion.



Une fois la préparation de la machine virtuelle terminée avec succès, l'état du modèle passe à « Actif ».

.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-376.png[État actif du plan]

====


== Étape 5 : Exécuter la migration

Déclenchez le processus de migration pour convertir les machines virtuelles Hyper-V en VMware ESXi.

.Avant de commencer
* Toutes les machines virtuelles sont arrêtées correctement conformément au calendrier de maintenance prévu.
* La machine virtuelle Shift Toolkit fait partie du domaine
* Le partage CIFS est configuré avec les autorisations appropriées.
* Les Qtrees ont le style de sécurité approprié
* Les services d'intégration sont activés sur toutes les machines virtuelles invitées.
* Le protocole SSH est activé sur les machines virtuelles invitées sous Linux.


.Étapes
. Sur le plan, cliquez sur *Migrer*.
+
.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-377.png[Bouton Migrer]

====
. Si les machines virtuelles restent allumées, répondez à l'invite d'arrêt progressif.
+
.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-378.png[Confirmation d'arrêt]

====
+
.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-379.png[Migration en cours]

====


.Résultat
L'outil Shift Toolkit effectue les étapes suivantes :

. Éteint les machines virtuelles sources
. Supprime les points de contrôle existants
. Déclenche des points de contrôle de machine virtuelle à la source
. Déclenche un instantané de volume avant la conversion du disque
. Clone et convertit les fichiers VHDx au format VMDK
. Met sous tension les machines virtuelles sur le site cible
. Enregistre les paramètres réseau
. Ajoute VMware Tools et attribue des adresses IP


La conversion s'effectue en quelques secondes, minimisant ainsi le temps d'arrêt de la machine virtuelle.

.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-380.png[Progression de la conversion]

====
Une fois la migration terminée, l'état du plan passe à « Migration terminée ».

.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-381.png[Migration terminée]

====


== Étape 6 : Valider la migration

Vérifiez que les machines virtuelles fonctionnent correctement sur l'hôte VMware ESXi.

.Étapes
. Connectez-vous à vCenter ou à l'hôte ESXi.
. Vérifiez que les machines virtuelles sont en cours d'exécution sur l'hôte ESXi spécifié.
+
.Afficher un exemple
[%collapsible]
====
image::shift-toolkit-382.png[Machines virtuelles exécutées sur ESXi]

====
. Vérifier la connectivité de la machine virtuelle et le bon fonctionnement de l'application.
. (Machines virtuelles Windows uniquement) Mettez en ligne les disques hors ligne si nécessaire :
+
[listing]
----
Set-StorageSetting -NewDiskPolicy OnlineAll
----
+

NOTE: Après la conversion, tous les disques VM sous Windows OS, à l'exception du disque du système d'exploitation, seront hors ligne en raison de la politique SAN par défaut de Microsoft Windows (offlineALL).  Cela empêche la corruption des données lorsque les LUN sont accessibles par plusieurs serveurs.



.Résultat
La migration d'Hyper-V vers VMware ESXi est terminée.


NOTE: Le Shift Toolkit utilise des tâches cron (Linux) et des tâches planifiées (Windows) pour les opérations post-migration.  Aucune connexion SSH ou équivalente n'est créée une fois les machines virtuelles exécutées sur les hôtes ESXi.
