---
sidebar: sidebar 
permalink: proxmox/proxmox-ontap-fc.html 
keywords: netapp, proxmox, proxmox ve, fc, fibre channel, lvm, ontap, storage 
summary: 'Configurer Logical Volume Manager (LVM) avec Fibre Channel pour l"environnement virtuel Proxmox à l"aide ONTAP. Cette procédure comprend la configuration multipath, le provisionnement LUN, la configuration igroup et la création de groupes de volumes pour le stockage partagé.' 
---
= Configurer LVM avec FC pour Proxmox VE
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Configurez Logical Volume Manager (LVM) pour le stockage partagé entre les hôtes Proxmox Virtual Environment (VE) utilisant le protocole Fibre Channel avec NetApp ONTAP. Cette configuration permet un accès au stockage au niveau bloc avec des performances élevées et une faible latence.



== Tâches initiales de l'administrateur de virtualisation

Effectuez ces tâches initiales pour préparer les hôtes Proxmox VE à la connectivité FC et recueillir les informations nécessaires à l'administrateur de stockage.

. Vérifiez que deux interfaces HBA sont disponibles.
. Assurez-vous que multipath-tools est installé sur tous les hôtes Proxmox VE et qu'il démarre au démarrage.
+
[source, shell]
----
apt list | grep multipath-tools
# If need to install, execute the following line.
apt-get install multipath-tools
systemctl enable multipathd
----
. Collectez le WWPN de tous les hôtes Proxmox VE et fournissez-le à l'administrateur du stockage.
+
[source, shell]
----
cat /sys/class/fc_host/host*/port_name
----




== Tâches de l'administrateur de stockage

Si vous débutez avec ONTAP, utilisez System Manager pour une meilleure expérience.

. Assurez-vous que le SVM est disponible avec le protocole FC activé. Suivre link:https://docs.netapp.com/us-en/ontap/san-admin/provision-storage.html["Documentation ONTAP 9"].
. Créez deux LIF par contrôleur dédiés au FC.
+
image:proxmox-ontap-fc-001.png["Détails de l'interface FC"]

. Créez un igroup et renseignez les initiateurs FC hôtes.
. Créez le LUN de la taille souhaitée sur le SVM et présentez-le à l'igroup créé à l'étape précédente. Assurez-vous que la protection anti-ransomware est activée dans l'onglet Sécurité pour les systèmes ASA et dans l'onglet Sécurité des volumes pour les systèmes AFF/ FAS .
+
image:proxmox-ontap-fc-002.png["détails du soleil"]

. Informez l'administrateur de virtualisation que le LUN a été créé.




== Tâches finales de l'administrateur de virtualisation

Effectuez ces tâches pour configurer le LUN en tant que stockage LVM partagé dans Proxmox VE.

. Accédez à un shell sur chaque hôte Proxmox VE du cluster et vérifiez que le disque est visible.
+
[source, shell]
----
lsblk -S
rescan-scsi-bus.sh
lsblk -S
----
. Vérifiez que le périphérique figure bien dans la liste multipath.
+
[source, shell]
----
multipath -ll
multipath -a /dev/sdX  # replace sdX with the device name
multipath -r
multipath -ll
----
. Créer le groupe de volumes.
+
[source, shell]
----
vgcreate <volume group name> /dev/mapper/<device id>
# Where <volume group name> is the desired name for the volume group and <device id> is the multipath device id.
pvs
# Verify the physical volume is part of the volume group.
vgs
# Verify the volume group is created.
----
. Utilisation de l'interface utilisateur de gestion à `https:<proxmox node>:8006`, cliquez sur Centre de données, sélectionnez Stockage, cliquez sur Ajouter et sélectionnez LVM.
+
.Afficher un exemple
[%collapsible]
====
image:proxmox-ontap-fc-003.png["navigation dans le stockage LVM"]

====
. Indiquez le nom de l'identifiant de stockage, choisissez le groupe de volumes existant et sélectionnez le groupe de volumes qui vient d'être créé avec l'interface de ligne de commande. Cochez l'option partagée. Avec Proxmox VE 9 et versions ultérieures, activez la fonction `Allow Snapshots as Volume-Chain` cette option est visible lorsque la case à cocher « Avancé » est activée.
+
.Afficher un exemple
[%collapsible]
====
image:proxmox-ontap-fc-004.png["création de stockage lvm"]

====
. L'exemple de fichier de configuration de stockage pour LVM utilisant FC est présenté ci-dessous :
+
.Afficher un exemple
[%collapsible]
====
image:proxmox-ontap-fc-005.png["configuration fc lvm"]

====
+
Avec Proxmox VE 9 et versions ultérieures, le fichier de configuration du stockage inclut l'option supplémentaire `snapshot-as-volume-chain 1` quand `Allow Snapshots as Volume-Chain` est activé.


