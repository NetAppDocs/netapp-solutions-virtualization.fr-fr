---
sidebar: sidebar 
permalink: vmware/vmw-vcf-vmsc-mgmt-mcc.html 
keywords: netapp, vmware, cloud, foundation, vcf, aff, all-flash, nfs, array, ontap tools, otv, sddc, sddc manager, ontap tools, metrocluster 
summary:  
---
= Configurer un cluster extensible pour un domaine de gestion VCF à l'aide de MetroCluster
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Dans ce cas d'utilisation, nous décrivons la procédure de configuration d'un cluster extensible pour le domaine de gestion VMware Cloud Foundation (VCF) à l'aide ONTAP MetroCluster avec NFS comme banque de données principale.  Cette procédure inclut le déploiement des hôtes vSphere et de vCenter Server, le provisionnement des banques de données NFS, la validation du cluster avec l'outil d'importation VCF, la configuration des paramètres NSX et la conversion de l'environnement en domaine de gestion VCF.

image:vmw-vcf-vmsc-mgmt-mcc-001.png["Domaine de gestion VCF avec vMSC, largeur = 500"]



== Introduction

Dans cette solution, nous allons démontrer comment implémenter un domaine de gestion VCF étendu avec NFS comme magasin de données principal à l'aide d' ONTAP MetroCluster.



== Aperçu du scénario

Ce scénario couvre les étapes de haut niveau suivantes :

* Déployez les hôtes vSphere et le serveur vCenter.
* Provisionnez la banque de données NFS sur les hôtes vSphere.
* Déployez le gestionnaire SDDC dans le cluster vSphere.
* Utilisez l’outil d’importation VCF pour valider le cluster vSphere.
* Configurez un fichier JSON pour créer un NSX pendant la conversion VCF.
* Utilisez l’outil d’importation VCF pour convertir l’environnement vSphere 8 en domaine de gestion VCF.




== Prérequis

Ce scénario nécessite les composants et configurations suivants :

* Configuration ONTAP MetroCluster prise en charge
* Machine virtuelle de stockage (SVM) configurée pour autoriser le trafic NFS.
* L'interface logique (LIF) a été créée sur le réseau IP qui doit transporter le trafic NFS et est associée au SVM.
* Un cluster vSphere 8 avec 4 hôtes ESXi connectés au commutateur réseau.
* Téléchargez le logiciel requis pour la conversion VCF.


Voici un exemple de capture d'écran du Gestionnaire de système montrant la configuration de MetroCluster .image:vmw-vcf-vmsc-mgmt-mcc-015.png["IP MetroCluster à 4 nœuds"]

et voici les interfaces réseau SVM des deux domaines de pannes.image:vmw-vcf-vmsc-mgmt-mcc-013.png["Interfaces réseau SVM du domaine de pannes 1"]

image:vmw-vcf-vmsc-mgmt-mcc-014.png["Interfaces réseau SVM du domaine de pannes 2"]

[REMARQUE] SVM sera actif sur l'un des domaines de pannes dans MetroCluster.

image:vmw-vcf-vmsc-mgmt-mcc-016.png["SVM sur le domaine de pannes 1"]

image:vmw-vcf-vmsc-mgmt-mcc-017.png["SVM sur le domaine de pannes 2"]

Référer https://knowledge.broadcom.com/external/article/312183/vmware-vsphere-support-with-netapp-metro.html["vMSC avec MetroCluster"] .

Pour le stockage pris en charge et d'autres considérations pour la conversion ou l'importation de vSphere vers VCF 5.2, reportez-vous à https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/map-for-administering-vcf-5-2/importing-existing-vsphere-environments-admin/considerations-before-converting-or-importing-existing-vsphere-environments-into-vcf-admin.html["Considérations avant de convertir ou d'importer des environnements vSphere existants dans VMware Cloud Foundation"] .

Avant de créer un cluster vSphere qui sera converti en domaine de gestion VCF, reportez-vous à https://knowledge.broadcom.com/external/article/373968/vlcm-config-manager-is-enabled-on-this-c.html["Considérations NSX sur le cluster vSphere"]

Pour les logiciels requis, reportez-vous à https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/map-for-administering-vcf-5-2/importing-existing-vsphere-environments-admin/download-software-for-converting-or-importing-existing-vsphere-environments-admin.html["Télécharger un logiciel pour convertir ou importer des environnements vSphere existants"] .

Pour plus d'informations sur la configuration des systèmes de stockage ONTAP , reportez-vous aulink:https://docs.netapp.com/us-en/ontap["Documentation ONTAP 9"] centre.

Pour plus d'informations sur la configuration de VCF, reportez-vous àlink:https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2.html["Documentation de VMware Cloud Foundation"] .



== Étapes de déploiement

Pour déployer le domaine de gestion étendu VCF avec NFS comme magasin de données principal,

Suivez les étapes suivantes :

* Déployez les hôtes vSphere et vCenter.
* Créer un cluster vSphere.
* Provisionner la banque de données NFS.
* Copiez l’outil d’importation VCF sur l’appliance vCenter.
* Exécutez une pré-vérification sur l’appliance vCenter à l’aide de l’outil d’importation VCF.
* Déployez la machine virtuelle du gestionnaire SDDC sur le cluster vCenter.
* Créez un fichier JSON pour un cluster NSX à déployer pendant le processus de conversion.
* Téléchargez le logiciel requis sur le gestionnaire SDDC.
* Convertissez le cluster vSphere en domaine de gestion VCF.


Pour un aperçu du processus de conversion, reportez-vous à https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/map-for-administering-vcf-5-2/importing-existing-vsphere-environments-admin/convert-or-import-a-vsphere-environment-into-vmware-cloud-foundation-admin.html["Convertir un environnement vSphere en domaine de gestion ou importer un environnement vSphere en tant que domaine de charge de travail VI dans VMware Cloud Foundation"] .



=== Déployer des hôtes vSphere et vCenter

Déployez vSphere sur des hôtes à l'aide d'ISO téléchargés à partir du portail de support Broadcom ou utilisez l'option de déploiement existante pour l'hôte vSphere.

.Monter le magasin de données NFS pour héberger des machines virtuelles
[%collapsible%open]
====
Dans cette étape, nous créons le volume NFS et le montons en tant que magasin de données pour héberger des machines virtuelles.

. À l’aide du Gestionnaire système, créez un volume et attachez-le à la stratégie d’exportation qui inclut le sous-réseau IP de l’hôte vSphere.image:vmw-vcf-vmsc-mgmt-mcc-002.png["Création de volume NFS avec System Manager"]
. Connectez-vous à l'hôte vSphere en SSH et montez le magasin de données NFS.image:vmw-vcf-vmsc-mgmt-mcc-003.png["Monter le datastore NFS sur l'hôte vSphere"]
+
[REMARQUE] Si l'accélération matérielle est indiquée comme non prise en charge, assurez-vous que le dernier composant NFS VAAI (téléchargé depuis le portail de support NetApp ) est installé sur l'hôte vSphereimage:vmw-vcf-vmsc-mgmt-mcc-005.png["Installer le composant NFS VAAI"] et vStorage est activé sur le SVM qui héberge le volume.image:vmw-vcf-vmsc-mgmt-mcc-004.png["Activer vStorage sur SVM pour VAAI"]

. Répétez les étapes ci-dessus pour les besoins supplémentaires en matière de banque de données et assurez-vous que l'accélération matérielle est prise en charge.image:vmw-vcf-vmsc-mgmt-mcc-006.png["Liste des magasins de données.  Un de chaque domaine de panne"]


====
Déployez vCenter sur un magasin de données NFS.  Assurez-vous que le shell SSH et Bash est activé sur l’appliance vCenter.



=== Créer un cluster vSphere

. Connectez-vous au client Web vSphere, créez le centre de données et le cluster vSphere en ajoutant l'un des hôtes sur lesquels NFS VAAI est déployé.  Nous avons choisi de gérer tous les hôtes du cluster avec l’option d’image unique.  [CONSEIL] Ne sélectionnez pas Gérer la configuration au niveau du cluster.  Pour plus de détails, reportez-vous à https://knowledge.broadcom.com/external/article/373968/vlcm-config-manager-is-enabled-on-this-c.html["Considérations NSX sur le cluster vSphere"] .  Pour les meilleures pratiques vMSC avec ONTAP MetroCluster, consultez https://docs.netapp.com/us-en/ontap-apps-dbs/vmware/vmware_vmsc_design.html#netapp-storage-configuration["Directives de conception et de mise en œuvre des vMSC"]
. Ajoutez d’autres hôtes vSphere au cluster.
. Créez un commutateur distribué et ajoutez les groupes de ports.
. https://techdocs.broadcom.com/us/en/vmware-cis/vsan/vsan/8-0/vsan-network-design/migrating-from-standard-to-distributed-vswitch.html["Migrer la mise en réseau d’un vSwitch standard vers un commutateur distribué."]




=== Convertir l'environnement vSphere en domaine de gestion VCF

La section suivante décrit les étapes de déploiement du gestionnaire SDDC et de conversion du cluster vSphere 8 en domaine de gestion VCF 5.2.  Le cas échéant, la documentation VMware sera consultée pour plus de détails.

L'outil d'importation VCF, de VMware par Broadcom, est un utilitaire utilisé à la fois sur l'appliance vCenter et sur le gestionnaire SDDC pour valider les configurations et fournir des services de conversion et d'importation pour les environnements vSphere et VCF.

Pour plus d'informations, consultez  https://docs.vmware.com/en/VMware-Cloud-Foundation/5.2/vcf-admin/GUID-44CBCB85-C001-41B2-BBB4-E71928B8D955.html["Options et paramètres de l'outil d'importation VCF"] .

.Copier et extraire l'outil d'importation VCF
[%collapsible%open]
====
L'outil d'importation VCF est utilisé sur l'appliance vCenter pour valider que le cluster vSphere est dans un état sain pour le processus de conversion ou d'importation VCF.

Suivez les étapes suivantes :

. Suivez les étapes à https://docs.vmware.com/en/VMware-Cloud-Foundation/5.2/vcf-admin/GUID-6ACE3794-BF52-4923-9FA2-2338E774B7CB.html["Copiez l'outil d'importation VCF sur l'appliance vCenter cible"] dans VMware Docs pour copier l'outil d'importation VCF à l'emplacement correct.
. Extrayez le bundle à l’aide de la commande suivante :
+
....
tar -xvf vcf-brownfield-import-<buildnumber>.tar.gz
....


====
.Valider l'appliance vCenter
[%collapsible%open]
====
Utilisez l’outil d’importation VCF pour valider l’appliance vCenter avant la conversion.

. Suivez les étapes à https://docs.vmware.com/en/VMware-Cloud-Foundation/5.2/vcf-admin/GUID-AC6BF714-E0DB-4ADE-A884-DBDD7D6473BB.html["Exécutez une pré-vérification sur le vCenter cible avant la conversion"] pour exécuter la validation.
. La sortie suivante montre que l’appliance vCenter a réussi la pré-vérification.
+
image:vmw-vcf-vmsc-mgmt-mcc-007.png["outil d'importation vcf pré-vérification"]



====
.Déployer le gestionnaire SDDC
[%collapsible%open]
====
Le gestionnaire SDDC doit être colocalisé sur le cluster vSphere qui sera converti en domaine de gestion VCF.

Suivez les instructions de déploiement dans VMware Docs pour terminer le déploiement.

image:vmw-vcf-vmsc-mgmt-mcc-008.png["Avant la conversion VCF"]

Se référer à https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/map-for-administering-vcf-5-2/importing-existing-vsphere-environments-admin/convert-or-import-a-vsphere-environment-into-vmware-cloud-foundation-admin/deploy-the-sddc-manager-appliance-on-the-target-vcenter-admin.html["Déployer l'appliance SDDC Manager sur le vCenter cible"] .

====
.Créer un fichier JSON pour le déploiement NSX
[%collapsible%open]
====
Pour déployer NSX Manager lors de l’importation ou de la conversion d’un environnement vSphere dans VMware Cloud Foundation, créez une spécification de déploiement NSX.  Le déploiement de NSX nécessite un minimum de 3 hôtes.


NOTE: Lors du déploiement d'un cluster NSX Manager dans une opération de conversion ou d'importation, le segment sauvegardé par NSX VLAN est utilisé.  Pour plus de détails sur les limitations du segment sauvegardé par NSX-VLAN, reportez-vous à la section « Considérations avant la conversion ou l'importation d'environnements vSphere existants dans VMware Cloud Foundation ».  Pour plus d'informations sur les limitations du réseau NSX-VLAN, reportez-vous à https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/map-for-administering-vcf-5-2/importing-existing-vsphere-environments-admin/considerations-before-converting-or-importing-existing-vsphere-environments-into-vcf-admin.html["Considérations avant de convertir ou d'importer des environnements vSphere existants dans VMware Cloud Foundation"] .

Voici un exemple de fichier JSON pour le déploiement NSX :

....
{
  "deploy_without_license_keys": true,
  "form_factor": "small",
  "admin_password": "******************",
  "install_bundle_path": "/nfs/vmware/vcf/nfs-mount/bundle/bundle-133764.zip",
  "cluster_ip": "10.61.185.114",
  "cluster_fqdn": "mcc-nsx.sddc.netapp.com",
  "manager_specs": [{
    "fqdn": "mcc-nsxa.sddc.netapp.com",
    "name": "mcc-nsxa",
    "ip_address": "10.61.185.111",
    "gateway": "10.61.185.1",
    "subnet_mask": "255.255.255.0"
  },
  {
    "fqdn": "mcc-nsxb.sddc.netapp.com",
    "name": "mcc-nsxb",
    "ip_address": "10.61.185.112",
    "gateway": "10.61.185.1",
    "subnet_mask": "255.255.255.0"
  },
  {
    "fqdn": "mcc-nsxc.sddc.netapp.com",
    "name": "mcc-nsxc",
    "ip_address": "10.61.185.113",
    "gateway": "10.61.185.1",
    "subnet_mask": "255.255.255.0"
  }]
}
....
Copiez le fichier JSON dans le dossier personnel de l'utilisateur vcf sur le gestionnaire SDDC.

====
.Télécharger le logiciel sur SDDC Manager
[%collapsible%open]
====
Copiez l'outil d'importation VCF dans le dossier de base de l'utilisateur vcf et le bundle de déploiement NSX dans le dossier /nfs/vmware/vcf/nfs-mount/bundle/ sur le gestionnaire SDDC.

Voir https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/map-for-administering-vcf-5-2/importing-existing-vsphere-environments-admin/convert-or-import-a-vsphere-environment-into-vmware-cloud-foundation-admin/seed-software-on-sddc-manager-admin.html["Téléchargez le logiciel requis sur l'appliance SDDC Manager"] pour des instructions détaillées.

====
.Vérification détaillée sur vCenter avant la conversion
[%collapsible%open]
====
Avant d'effectuer une opération de conversion de domaine de gestion ou une opération d'importation de domaine de charge de travail VI, vous devez effectuer une vérification détaillée pour vous assurer que la configuration de l'environnement vSphere existant est prise en charge pour la conversion ou l'importation. .  Connectez-vous en SSH à l'appliance SDDC Manager en tant qu'utilisateur vcf. .  Accédez au répertoire dans lequel vous avez copié l’outil d’importation VCF. .  Exécutez la commande suivante pour vérifier que l’environnement vSphere peut être converti

....
python3 vcf_brownfield.py check --vcenter '<vcenter-fqdn>' --sso-user '<sso-user>' --sso-password '********' --local-admin-password '****************' --accept-trust
....
====
.Convertir un cluster vSphere en domaine de gestion VCF
[%collapsible%open]
====
L'outil d'importation VCF est utilisé pour effectuer le processus de conversion.

La commande suivante est exécutée pour convertir le cluster vSphere en domaine de gestion VCF et déployer le cluster NSX :

....
python3 vcf_brownfield.py convert --vcenter '<vcenter-fqdn>' --sso-user '<sso-user>' --sso-password '******' --vcenter-root-password '********' --local-admin-password '****************' --backup-password '****************' --domain-name '<Mgmt-domain-name>' --accept-trust --nsx-deployment-spec-path /home/vcf/nsx.json
....
Lorsque plusieurs banques de données sont disponibles sur l'hôte vSphere, il demande quelle banque de données doit être considérée comme banque de données principale sur laquelle les machines virtuelles NSX seront déployées par défaut.image:vmw-vcf-vmsc-mgmt-mcc-012.png["Sélectionner le magasin de données principal"]

Pour des instructions complètes, reportez-vous à https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/map-for-administering-vcf-5-2/importing-existing-vsphere-environments-admin/convert-or-import-a-vsphere-environment-into-vmware-cloud-foundation-admin.html["Procédure de conversion VCF"] .

Les machines virtuelles NSX seront déployées sur vCenter.image:vmw-vcf-vmsc-mgmt-mcc-009.png["Après la conversion VCF"]

SDDC Manager affiche le domaine de gestion créé avec le nom fourni et NFS comme magasin de données.image:vmw-vcf-vmsc-mgmt-mcc-010.png["Domaine de gestion VCF avec NFS"]

Lors de l'inspection du cluster, il fournit les informations du magasin de données NFS.image:vmw-vcf-vmsc-mgmt-mcc-011.png["Détails du magasin de données NFS à partir de VCF"]

====
.Ajouter une licence à VCF
[%collapsible%open]
====
Une fois la conversion terminée, la licence doit être ajoutée à l'environnement.

. Connectez-vous à l'interface utilisateur du gestionnaire SDDC.
. Accédez à *Administration > Licences* dans le volet de navigation.
. Cliquez sur *+ Clé de licence*.
. Choisissez un produit dans le menu déroulant.
. Entrez la clé de licence.
. Fournissez une description de la licence.
. Cliquez sur *Ajouter*.
. Répétez ces étapes pour chaque licence.


====