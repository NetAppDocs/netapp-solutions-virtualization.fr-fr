---
sidebar: sidebar 
permalink: vmware/vmw-vcf-mgmt-fc.html 
keywords: netapp, vmware, cloud, foundation, vcf, asa, aff, all-flash, fc, array, ontap tools, otv, sddc, sddc manager, ontap tools, ontap tools 10 
summary:  
---
= Convertir une instance de serveur vCenter en domaine de gestion VCF (datastore FC)
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Convertissez un cluster vSphere 8 utilisant des banques de données ONTAP Fibre Channel en un domaine de gestion VMware Cloud Foundation.  Cette procédure comprend le provisionnement du stockage FC, le déploiement des outils ONTAP pour VMware et l'utilisation de l'outil d'importation VCF pour migrer et gérer le cluster dans l'environnement VCF.



== Introduction

La conversion d'un environnement vSphere, avec une banque de données Fibre Channel (FC) existante exécutée sur ONTAP, implique l'intégration de l'infrastructure existante dans une architecture de cloud privé moderne.  Ce processus bénéficie de la robustesse du stockage FC, pour garantir un accès et une gestion des données transparents.  Une fois qu'un domaine de gestion VCF est établi via le processus de conversion, les administrateurs peuvent importer efficacement des environnements vSphere supplémentaires, y compris ceux utilisant des banques de données FC, dans l'écosystème VCF.  Cette intégration améliore non seulement l’utilisation des ressources, mais simplifie également la gestion de l’infrastructure de cloud privé, garantissant une transition en douceur avec une perturbation minimale des charges de travail existantes.

Dans cette solution, nous allons démontrer comment une banque de données FC dans vSphere 8 devient un stockage principal lorsque le cluster est converti en domaine de gestion VCF.



== Aperçu du scénario

Ce scénario couvre les étapes de haut niveau suivantes :

* Déployez les ONTAP tools for VMware vSphere 10.
* Provisionnez une banque de données FC à l’aide des outils ONTAP .
* Utilisez l’outil d’importation VCF pour valider le cluster vSphere.
* Déployez le gestionnaire SDDC dans le cluster vSphere.
* Configurez un fichier JSON pour créer NSX pendant la conversion VCF.
* Utilisez l'outil d'importation VCF pour convertir le cluster vSphere 8 en VCF 5.2.1




== Prérequis

Ce scénario nécessite les composants et configurations suivants :

* Système de stockage NetApp ASA R2/ ASA/ AFF avec une machine virtuelle de stockage (SVM) configurée pour autoriser le trafic Fibre Channel (FC).
* L'interface logique (LIF) a été créée pour transporter le trafic FC et est associée au SVM.
* Le zonage FC a été configuré sur les commutateurs désignés pour transporter le trafic FC.
* Un cluster vSphere 8 avec 4 hôtes ESXi et une appliance vCenter colocalisée sur le cluster.
* Groupe de ports distribués configuré pour vMotion sur les VLAN ou segments de réseau établis à cet effet.
* Téléchargez le logiciel requis pour la conversion VCF.


Les ONTAP tools for VMware vSphere 10 peuvent être installés dans des configurations HA ou non HA.  Pour des informations complètes sur les prérequis pour les outils ONTAP , reportez-vous à https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/deploy/prerequisites.html#system-requirements["Prérequis pour les ONTAP tools for VMware vSphere"] .

Pour le stockage pris en charge et d'autres considérations pour la conversion ou l'importation de vSphere vers VCF 5.2, reportez-vous à https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/map-for-administering-vcf-5-2/importing-existing-vsphere-environments-admin/considerations-before-converting-or-importing-existing-vsphere-environments-into-vcf-admin.html["Considérations avant de convertir ou d'importer des environnements vSphere existants dans VMware Cloud Foundation"] .

Pour les logiciels requis, reportez-vous à https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/map-for-administering-vcf-5-2/importing-existing-vsphere-environments-admin/download-software-for-converting-or-importing-existing-vsphere-environments-admin.html["Télécharger un logiciel pour convertir ou importer des environnements vSphere existants"] .

Pour plus d'informations sur la configuration des systèmes de stockage ONTAP , reportez-vous aulink:https://docs.netapp.com/us-en/ontap["Documentation ONTAP 9"] centre.

Pour plus d'informations sur la configuration de VCF, reportez-vous àlink:https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2.html["Documentation de VMware Cloud Foundation 5.2"] .



== Étapes de déploiement

La solution couvre l’utilisation des ONTAP tools for VMware vSphere pour provisionner des banques de données FC et le processus de conversion d’un cluster vSphere 8 existant en un domaine de gestion VCF.

Suivez les étapes suivantes :

* Déployez les ONTAP tools for VMware vSphere 10.
* Provisionnez une banque de données FC à l’aide des outils ONTAP .
* Copiez l’outil d’importation VCF sur l’appliance vCenter.
* Exécutez une pré-vérification sur l’appliance vCenter à l’aide de l’outil d’importation VCF.
* Déployez la machine virtuelle du gestionnaire SDDC sur le cluster vCenter.
* Créez un fichier JSON pour un cluster NSX à déployer pendant le processus de conversion.
* Téléchargez le logiciel requis sur le gestionnaire SDDC.
* Convertissez le cluster vSphere en inventaire du gestionnaire SDDC.


Pour un aperçu du processus de conversion, reportez-vous à https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/map-for-administering-vcf-5-2/importing-existing-vsphere-environments-admin/convert-or-import-a-vsphere-environment-into-vmware-cloud-foundation-admin.html["Convertir un environnement vSphere en domaine de gestion ou importer un environnement vSphere en tant que domaine de charge de travail VI dans VMware Cloud Foundation"] .



=== Déployer les outils ONTAP et provisionner une banque de données FC

L'architecture des outils ONTAP 10 est conçue pour s'intégrer de manière transparente aux environnements VMware, en s'appuyant sur un cadre modulaire et évolutif qui inclut les services des outils ONTAP , le plug-in vSphere et les API REST pour permettre une gestion efficace du stockage, de l'automatisation et de la protection des données.

Les ONTAP tools for VMware vSphere 10 peuvent être installés dans des configurations HA ou non HA.

image:vmware-vcf-import-nfs-010.png["Architecture des outils ONTAP"]

.Déployer les ONTAP tools for VMware vSphere 10
[%collapsible%open]
====
Dans cette étape, ONTAP Tools 10 est déployé avec une configuration non HA.

Pour plus de détails sur le déploiement des configurations HA et non HA, reportez-vous à https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/deploy/ontap-tools-deployment.html["Déployer les ONTAP tools for VMware vSphere"] .

. Téléchargez le modèle OVA des outils ONTAP 10 à partir du https://mysupport.netapp.com/site/["Site d'assistance NetApp"] .
. Dans le client vSphere, faites un clic droit sur le cluster et cliquez sur *Déployer le modèle OVF*
+
image:vmware-vcf-import-nfs-001.png["Déployer le modèle OVF"]

+
{nbsp}

. Dans le *Déployer le modèle OVF*, suivez les étapes pour :
+
** Sélectionnez un modèle OVF.
** Sélectionnez un nom et un dossier.
** Sélectionnez une ressource de calcul.
** Détails de l'examen.
** Accepter le contrat de licence.


. Sur la page *Configuration* du modèle, sélectionnez le type de déploiement, notamment si vous souhaitez déployer les outils ONTAP dans une configuration HA. Cliquez sur *Suivant* pour continuer.
+
image:vmware-vcf-import-nfs-002.png["configuration - type de déploiement"]

+
{nbsp}

. Sur la page *Sélectionner le stockage*, choisissez le magasin de données sur lequel installer la machine virtuelle, puis cliquez sur *Suivant*.
. Sélectionnez le réseau sur lequel la machine virtuelle des outils ONTAP communiquera. Cliquez sur *Suivant* pour continuer.
. Dans la fenêtre « Personnaliser le modèle », remplissez toutes les informations requises.
+
** Nom d'utilisateur et mot de passe de l'application
** Choisissez si vous souhaitez activer ASUP (prise en charge automatique), y compris une URL proxy.
** Nom d'utilisateur et mot de passe de l'administrateur.
** Serveurs NTP.
** Nom d'utilisateur et mot de passe de maintenance (compte de maintenance utilisé sur la console).
** Fournissez les adresses IP requises pour la configuration de déploiement.
** Fournissez toutes les informations réseau pour la configuration du nœud.
+
image:vmware-vcf-import-nfs-003.png["Personnaliser le modèle"]

+
{nbsp}



. Enfin, cliquez sur *Suivant* pour continuer puis sur *Terminer* pour commencer le déploiement.


====
.Configurer les outils ONTAP
[%collapsible%open]
====
Une fois la machine virtuelle des outils ONTAP installée et mise sous tension, certaines configurations de base seront requises, telles que l'ajout de serveurs vCenter et de systèmes de stockage ONTAP à gérer.  Consultez la documentation à l'adresse https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/index.html["Documentation des ONTAP tools for VMware vSphere"] pour des informations détaillées.

. Se référer à https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/configure/add-vcenter.html["Ajouter des instances vCenter"] pour configurer les instances vCenter à gérer avec les outils ONTAP .
. Pour ajouter un système de stockage ONTAP , connectez-vous au client vSphere et accédez au menu principal sur la gauche.  Cliquez sur * Outils NetApp ONTAP * pour lancer l'interface utilisateur.
+
image:vmware-vcf-import-nfs-004.png["ouvrir les outils ONTAP"]

+
{nbsp}

. Accédez à *Backends de stockage* dans le menu de gauche et cliquez sur *Ajouter* pour accéder à la fenêtre *Ajouter un backend de stockage*.
. Remplissez l'adresse IP et les informations d'identification du système de stockage ONTAP à gérer.  Cliquez sur *Ajouter* pour terminer.
+
image:vmware-vcf-import-nfs-005.png["Ajouter un backend de stockage"]




NOTE: Ici, le backend de stockage est ajouté dans l’interface utilisateur du client vSphere à l’aide de l’adresse IP du cluster.  Cela permet une gestion complète de tous les SVM du système de stockage.  Alternativement, le backend de stockage peut être ajouté et associé à une instance vCenter à l'aide du gestionnaire d'outils ONTAP à `https://loadBalanceIP:8443/virtualization/ui/` .  Avec cette méthode, seules les informations d'identification SVM peuvent être ajoutées à l'interface utilisateur du client vSphere, offrant un contrôle plus précis sur l'accès au stockage.

====
.Provisionner la banque de données FC avec les outils ONTAP
[%collapsible%open]
====
Les outils ONTAP intègrent des fonctionnalités dans toute l’interface utilisateur du client vSphere.  Dans cette étape, un magasin de données FC sera provisionné à partir de la page d’inventaire des hôtes.

. Dans le client vSphere, accédez à l’inventaire des hôtes (ou du stockage).
. Accédez à *ACTIONS > Outils NetApp ONTAP > Créer une banque de données*.
+
image:vmware-vcf-convert-fc-001.png["Créer un magasin de données"]

+
{nbsp}

. Dans l’assistant *Créer une banque de données*, sélectionnez VMFS comme type de banque de données à créer.
+
image:vmware-vcf-convert-fc-002.png["Type de magasin de données"]

+
{nbsp}

. Sur la page *Nom et protocole*, indiquez un nom pour le magasin de données, la taille et le protocole FC à utiliser.
+
image:vmware-vcf-convert-fc-003.png["Nom et protocole"]

+
{nbsp}

. Sur la page *Stockage*, sélectionnez la plate-forme de stockage ONTAP et la machine virtuelle de stockage (SVM).  Vous pouvez également sélectionner ici toutes les politiques d’exportation personnalisées disponibles. Cliquez sur *Suivant* pour continuer.
+
image:vmware-vcf-convert-fc-004.png["Page de stockage"]

+
{nbsp}

. Sur la page *Attributs de stockage*, sélectionnez l'agrégat de stockage à utiliser. Cliquez sur *Suivant* pour continuer.
. Sur la page *Résumé*, vérifiez les informations et cliquez sur *Terminer* pour commencer le processus de provisionnement.  Les outils ONTAP créeront un volume sur le système de stockage ONTAP et le monteront en tant que banque de données FC sur tous les hôtes ESXi du cluster.
+
image:vmware-vcf-convert-fc-005.png["Page de résumé"]



====


=== Convertir l'environnement vSphere en VCF 5.2

La section suivante décrit les étapes de déploiement du gestionnaire SDDC et de conversion du cluster vSphere 8 en domaine de gestion VCF 5.2.  Le cas échéant, la documentation VMware sera consultée pour plus de détails.

L'outil d'importation VCF, de VMware par Broadcom, est un utilitaire utilisé à la fois sur l'appliance vCenter et sur le gestionnaire SDDC pour valider les configurations et fournir des services de conversion et d'importation pour les environnements vSphere et VCF.

Pour plus d'informations, consultez  https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/map-for-administering-vcf-5-2/importing-existing-vsphere-environments-admin/vcf-import-tool-options-and-parameters-admin.html["Options et paramètres de l'outil d'importation VCF"] .

.Copier et extraire l'outil d'importation VCF
[%collapsible%open]
====
Les outils d'importation VCF sont utilisés sur l'appliance vCenter pour valider que le cluster vSphere est dans un état sain pour le processus de conversion ou d'importation VCF.

Suivez les étapes suivantes :

. Suivez les étapes à https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/copy-the-vcf-import-tool-to-the-target-vcenter-appliance.html["Copiez l'outil d'importation VCF sur l'appliance vCenter cible"] dans VMware Docs pour copier l'outil d'importation VCF à l'emplacement correct.
. Extrayez le bundle à l’aide de la commande suivante :
+
....
tar -xvf vcf-brownfield-import-<buildnumber>.tar.gz
....


====
.Valider l'appliance vCenter
[%collapsible%open]
====
Utilisez l’outil d’importation VCF pour valider l’appliance vCenter avant la conversion.

. Suivez les étapes à https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/run-a-precheck-on-the-target-vcenter-before-conversion.html["Exécuter une pré-vérification sur le vCenter cible avant la conversion"] pour exécuter la validation.
. La sortie suivante montre que l’appliance vCenter a réussi la pré-vérification.
+
image:vmware-vcf-import-nfs-011.png["outil d'importation vcf pré-vérification"]



====
.Déployer le gestionnaire SDDC
[%collapsible%open]
====
Le gestionnaire SDDC doit être colocalisé sur le cluster vSphere qui sera converti en domaine de gestion VCF.

Suivez les instructions de déploiement dans VMware Docs pour terminer le déploiement.

Se référer à https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/deploy-the-sddc-manager-appliance-on-the-target-vcenter.html["Déployer l'appliance SDDC Manager sur le vCenter cible"] .

Pour plus d'informations, voirlink:https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/4-5/administering/host-management-admin/commission-hosts-admin.html["Hôtes de la Commission"] dans le Guide d'administration du VCF.

====
.Créer un fichier JSON pour le déploiement NSX
[%collapsible%open]
====
Pour déployer NSX Manager lors de l’importation ou de la conversion d’un environnement vSphere dans VMware Cloud Foundation, créez une spécification de déploiement NSX.  Le déploiement de NSX nécessite un minimum de 3 hôtes.

Pour des informations complètes, reportez-vous à https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/generate-an-nsx-deployment-specification-for-converting-or-importing-existing-vsphere-environments.html["Générer une spécification de déploiement NSX pour la conversion ou l'importation d'environnements vSphere existants"] .


NOTE: Lors du déploiement d'un cluster NSX Manager dans une opération de conversion ou d'importation, la mise en réseau NSX-VLAN est utilisée.  Pour plus de détails sur les limitations de la mise en réseau NSX-VLAN, reportez-vous à la section « Considérations avant de convertir ou d'importer des environnements vSphere existants dans VMware Cloud Foundation ».  Pour plus d'informations sur les limitations du réseau NSX-VLAN, reportez-vous à https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/considerations-before-converting-or-importing-existing-vsphere-environments-into-vcf.html["Considérations avant de convertir ou d'importer des environnements vSphere existants dans VMware Cloud Foundation"] .

Voici un exemple de fichier JSON pour le déploiement NSX :

....
{
  "license_key": "xxxxx-xxxxx-xxxxx-xxxxx-xxxxx",
  "form_factor": "medium",
  "admin_password": "************************",
  "install_bundle_path": "/tmp/vcfimport/bundle-133764.zip",
  "cluster_ip": "172.21.166.72",
  "cluster_fqdn": "vcf-m02-nsx01.sddc.netapp.com",
  "manager_specs": [{
    "fqdn": "vcf-m02-nsx01a.sddc.netapp.com",
    "name": "vcf-m02-nsx01a",
    "ip_address": "172.21.166.73",
    "gateway": "172.21.166.1",
    "subnet_mask": "255.255.255.0"
  },
  {
    "fqdn": "vcf-m02-nsx01b.sddc.netapp.com",
    "name": "vcf-m02-nsx01b",
    "ip_address": "172.21.166.74",
    "gateway": "172.21.166.1",
    "subnet_mask": "255.255.255.0"
  },
  {
    "fqdn": "vcf-m02-nsx01c.sddc.netapp.com",
    "name": "vcf-m02-nsx01c",
    "ip_address": "172.21.166.75",
    "gateway": "172.21.166.1",
    "subnet_mask": "255.255.255.0"
  }]
}
....
Copiez le fichier JSON dans un répertoire du gestionnaire SDDC.

====
.Télécharger le logiciel sur SDDC Manager
[%collapsible%open]
====
Copiez l’outil d’importation VCF et le bundle de déploiement NSX dans le répertoire /home/vcf/vcfimport sur le gestionnaire SDDC.

Voir https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/seed-software-on-sddc-manager.html["Téléchargez le logiciel requis sur l'appliance SDDC Manager"] pour des instructions détaillées.

====
.Convertir un cluster vSphere en domaine de gestion VCF
[%collapsible%open]
====
L'outil d'importation VCF est utilisé pour effectuer le processus de conversion.  Exécutez la commande suivante à partir du répertoire /home/vcf/vcf-import-package/vcf-brownfield-import-<version>/vcf-brownfield-toolset pour consulter une impression des fonctions de l'outil d'importation VCF :

....
python3 vcf_brownfield.py --help
....
La commande suivante est exécutée pour convertir le cluster vSphere en domaine de gestion VCF et déployer le cluster NSX :

....
python3 vcf_brownfield.py convert --vcenter '<vcenter-fqdn>' --sso-user '<sso-user>' --domain-name '<wld-domain-name>' --nsx-deployment-spec-path '<nsx-deployment-json-spec-path>'
....
Pour des instructions complètes, reportez-vous à https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/import-workload-domain-into-sddc-manager-inventory.html["Convertir ou importer l'environnement vSphere dans l'inventaire du gestionnaire SDDC"] .

====
.Ajouter une licence à VCF
[%collapsible%open]
====
Une fois la conversion terminée, la licence doit être ajoutée à l'environnement.

. Connectez-vous à l'interface utilisateur du gestionnaire SDDC.
. Accédez à *Administration > Licences* dans le volet de navigation.
. Cliquez sur *+ Clé de licence*.
. Choisissez un produit dans le menu déroulant.
. Entrez la clé de licence.
. Fournissez une description de la licence.
. Cliquez sur *Ajouter*.
. Répétez ces étapes pour chaque licence.


====


== Démonstration vidéo des ONTAP tools for VMware vSphere 10

.Banque de données NFS avec ONTAP tools for VMware vSphere 10
video::1e4c3701-0bc2-41fa-ac93-b2680147f351[panopto,width=360]